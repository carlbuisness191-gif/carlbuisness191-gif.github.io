<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Googel Ad</title>
<style>
body { margin:0; padding:0; display:flex; justify-content:center; align-items:center; height:100%; background:transparent; }
img { display:block; width:100%; height:100%; border:none; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<div id="adContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// ------------------- FIREBASE CONFIG -------------------
const firebaseConfig = {
    apiKey: "AIzaSyD0NR98wFcLMYvEodcutKEZN-IQowZowS0",
    authDomain: "googelads-2f706.firebaseapp.com",
    projectId: "googelads-2f706",
    storageBucket: "googelads-2f706.appspot.com",
    messagingSenderId: "261049470494",
    appId: "1:261049470494:web:34c85ebe1fe50c23eca80f",
    measurementId: "G-1WLFT147GZ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ------------------- GET QUERY PARAM -------------------
function getParam(name) {
    try {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    } catch(e) {
        return null;
    }
}

// ------------------- MAIN -------------------
async function loadAd() {
    const typeParam = getParam('type') || 'side';
    const types = typeParam.split(',').map(t=>t.trim().toLowerCase()).filter(t=>t); // remove empty

    if(types.length===0){
        document.getElementById("adContainer").innerHTML="<p>No valid type specified</p>";
        return;
    }

    try {
        const snap = await getDocs(collection(db,"ads"));
        const ads = [];
        snap.forEach(docSnap=>{
            const ad = docSnap.data();
            // Only include ads whose type matches any of the types
            if(types.includes(ad.type.toLowerCase())){
                ads.push(ad);
            }
        });

        if(ads.length===0){
            document.getElementById("adContainer").innerHTML="<p>No ads available</p>";
            return;
        }

        // Pick a random ad
        const ad = ads[Math.floor(Math.random() * ads.length)];

        // Fix URL if missing protocol
        let url = ad.targetURL.trim();
        if(!/^https?:\/\//i.test(url)){
            url = 'https://' + url;
        }

        const img = document.createElement('img');
        img.src = ad.base64Image;
        img.alt = ad.title;
        img.onclick = ()=> window.open(url,'_blank');

        const container = document.getElementById("adContainer");
        container.innerHTML="";
        container.appendChild(img);

    } catch(err){
        console.error(err);
        document.getElementById("adContainer").innerHTML="<p>Error loading ad</p>";
    }
}

// ------------------- IGNORE ID -------------------
loadAd();
</script>

</body>
</html>
